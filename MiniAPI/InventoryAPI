local Assets = LoadAPI.getAssets()
local playerInventory = {}

function newInventory(size) -- The glorified table.
  newInventory = {}
  
  if size then
    newInventory["size"] = size
  end

  return newInventory
end

function addItem(inv, id, amount)
  for i = 1, #inv do
    if inv[i].ID == id then
      inv[i].Amount = inv[i].Amount + amount
      return
    end
  end

  local next = #inv + 1
  inv[next] = {}
  inv[next] = Assets[id]
  inv[next].Amount = amount
  inv[next].ID = id

  updateInventory(inv)
end

function removeItem(inv, id, amount)
  for i = 1, #inv do
    if inv[i].ID == id then
      inv[i].Amount = inv[i].Amount - amount
    end
  end
  remove = updateInventory(inv)
  return remove
end


function updateInventory(inv)
  for i = 1, #inv do
    if inv[i].Amount ~= nil then
      if inv[i].Amount <= 0 then
        table.remove(inv, i)
        return true
      end
    end
    
    if inv[i].durability then
      if inv[i].durability <= 0 then
        table.remove(inv, i)
        return true
      end
    end
  end
end

function checkInventory(inv, id)
  for i = 1, #inv do
    if inv[i].ID == id then
      return true, inv[i].Amount, i
    end
  end
end

local selected = 1
function openInventory(inv, e, p1, p2, p3)
  MenuAPI.menuList(2, 5, 18, 14, "INVENTORY", inv, selected) 
  if e == "key" then 
    local ID, pNum = MenuAPI.menuList(2, 5, 18, 14, "INVENTORY", inv, selected) 

    if p1 == 17 or p1 == 200 then -- Up Key
      selected = selected - 1
      if selected < 1 then
        selected = #inv
      end    

    elseif p1 == 31 or p1 == 208 then -- Down Key
      selected = selected + 1
      if selected > #inv then
        selected = 1
      end

    elseif p1 == 16 or p1 == 28 or p1 == 18 then -- Q, Enter, E
      updateInventory(inv)
      return false, nil, selected
    end
    MenuAPI.menuList(2, 5, 18, 14, "INVENTORY", inv, selected) 
  end

  if ID ~= nil then
    return true, ID, selected
  else
    return true, nil, 1
  end
end

function getPlayerInventory()
  return playerInventory
end

function setPlayerInventory(inv)
  if type(inv) == "table" then
    playerInventory = inv
  end
end