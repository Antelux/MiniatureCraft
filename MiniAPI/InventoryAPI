local Assets = LoadAPI.getAssets()

function newInventory(size)
  newInventory = {}
  
  if size then
    newInventory["size"] = size
  end

  return newInventory
end

function addItem(inv, id, amount)
  local same = false

  for i = 1, #inv do
    if inv[i].ID == id then
      inv[i].Amount = inv[i].Amount + amount
      same = true
      break
    end
  end

  if same == false then
    local next = #inv + 1
    inv[next] = {}
    inv[next] = Assets[id]
    inv[next].Amount = amount
    inv[next].ID = id
  end
  updateInventory(inv)
end

function removeItem(inv, id, amount)
  for i = 1, #inv do
    if inv[i].ID == id then
      inv[i].Amount = inv[i].Amount - amount
    end
  end
  remove = updateInventory(inv)
  return remove
end


function updateInventory(inv)
  for i = 1, #inv do
    if inv[i].Amount ~= nil then
      if inv[i].Amount <= 0 then
        table.remove(inv, i)
        return true
      end
    end
    
    if inv[i].durability then
      if inv[i].durability <= 0 then
        table.remove(inv, i)
        return true
      end
    end
  end
end

function checkInventory(inv, id)
  for i = 1, #inv do
    if inv[i].ID == id then
      noItems = false
      return true, inv[i].Amount, i
    else  
      noItems = true
    end
  end
  if noItems then
    return false
  end
end

local selected = 1
function openInventory(inv, e, p1, p2, p3)
  MenuAPI.menuList(2, 5, 18, 14, "INVENTORY", inv, selected) 
  if e == "key" then 
    local ID, pNum = MenuAPI.menuList(2, 5, 18, 14, "INVENTORY", inv, selected) 

    if p1 == 17 or p1 == 200 then -- Up Key
      selected = selected - 1
      if selected < 1 then
        selected = #inv
      end    

    elseif p1 == 31 or p1 == 208 then -- Down Key
      selected = selected + 1
      if selected > #inv then
        selected = 1
      end

    elseif p1 == 16 or p1 == 28 or p1 == 18 then -- Q, Enter, E
      updateInventory(inv)
      return false, nil, selected
    end
    MenuAPI.menuList(2, 5, 18, 14, "INVENTORY", inv, selected) 
  end

  if ID ~= nil then
    return true, ID, selected
  else
    return true, nil, 1
  end
end

function getCreativeInput(inv, e, p1, p2, p3)
  MenuAPI.createMenu(2, 5, 18, 14, "CREATIVE")
  term.setCursorPos(4,7)
  term.setTextColor(colors.white)
  print("Give ID:")
  paintutils.drawLine(13,7,17,7,colors.gray)
  if e == "mouse_click" then
    if p1 == 1 then
      if p2 <= 17 and p2 >= 13 and p3 == 7 then 
        term.setCursorPos(14,7)
        paintutils.drawLine(13,7,17,7,colors.lightGray)
        input = read()
      end
    end
  elseif e == "key" then
    if p1 == 16 then --or p1 == 28 then -- Q
      return false
    end
  end
end